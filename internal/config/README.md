# `internal/config`

このディレクトリは、`estore-trade` アプリケーションの設定管理を行う `config` パッケージ

## 概要

`config` パッケージは、アプリケーションの実行に必要な設定情報を環境変数 (または `.env` ファイル) から読み込み、`Config` 構造体に格納する責務を持つ
アプリケーションの各コンポーネントは、この `Config` 構造体を通じて設定値にアクセスする

## ファイル構成

*   `strct_config.go`: `Config` 構造体の定義
*   `util_login_config.go`: `LoadConfig` 関数 (設定読み込み) の定義

## `strct_config.go` (構造体定義)

*   **役割**: アプリケーションの設定情報を保持する `Config` 構造体を定義
*   **詳細**:
    *   `Config` 構造体は、以下のフィールドを持つ
        *   `TachibanaAPIKey`: 立花証券APIのAPIキー (必須)
        *   `TachibanaAPISecret`: 立花証券APIのAPIシークレット (必須)
        *   `TachibanaBaseURL`: 立花証券APIのベースURL (必須)
        *   `TachibanaUserID`: 立花証券APIのユーザーID (必須)
        *   `TachibanaPassword`: 立花証券APIのパスワード (必須)
        *   `DBHost`: データベースのホスト名 (必須)
        *   `DBPort`: データベースのポート番号 (未設定の場合は 5432 がデフォルト)
        *   `DBUser`: データベースのユーザー名 (必須)
        *   `DBPassword`: データベースのパスワード (必須)
        *   `DBName`: データベース名 (必須)
        *   `LogLevel`: ログレベル (debug, info, warn, error など) (必須)
        *   `EventRid`: EVENT I/F の `p_rid` パラメータ (固定値、必須)
        *   `EventBoardNo`: EVENT I/F の `p_board_no` パラメータ (固定値、必須)
        *   `EventEvtCmd`: EVENT I/F の `p_evt_cmd` パラメータ (固定値、必須)
        *   `HTTPPort`: HTTPサーバーのポート番号 (未設定の場合は 8080 がデフォルト)

## `util_login_config.go` (設定読み込み関数)

*   **役割**: 環境変数 (または `.env` ファイル) から設定情報を読み込み、`Config` 構造体のインスタンスを生成
*   **詳細**:
    *   `LoadConfig` 関数は、以下の処理を行う
        1.  `.env` ファイルの読み込み (任意): `godotenv.Load` を使用して、指定されたパスの `.env` ファイルから環境変数を読み込む
            *   `.env` ファイルは必須ではない。`.env` が見つからない場合でも、環境変数が設定されていれば続行する
        2.  環境変数の取得: `os.Getenv` を使用して、各設定項目に対応する環境変数を取得
        3.  数値への変換: データベースポート (`DB_PORT`) とHTTPポート (`HTTP_PORT`) は、`strconv.Atoi` を使用して整数に変換
            *   `DB_PORT`: 環境変数が未設定、または数値に変換できない場合は、デフォルト値 5432 を使用
            *   `HTTP_PORT`: 環境変数が未設定の場合は、デフォルト値 8080 を使用。数値に変換できない場合はエラーを返す
        4.  `Config` インスタンスの生成: 取得した設定値を `Config` 構造体のフィールドに設定し、インスタンスを返す

## 依存関係

*   `github.com/joho/godotenv`: `.env` ファイルから環境変数を読み込むためのライブラリ

## エラーハンドリング

`LoadConfig` 関数は、以下のいずれかの場合にエラーを返す

*   `DB_PORT` 環境変数が設定されているが、数値に変換できない場合
*   `HTTP_PORT` 環境変数が設定されているが、数値に変換できない場合

エラーが発生した場合、アプリケーションは設定情報を取得できず、正常に起動できない可能性がある
エラーを適切に処理 (例: エラーログを出力してアプリケーションを終了する) する必要がある

## テスト
`config`パッケージには`config_test.go`があり、`LoadConfig`関数のユニットテストが実装されている
* 異なる環境変数の設定パターン(正常系、異常系)でテスト
* 環境変数が未設定の場合にデフォルト値が使用されることをテスト
* 不正な値が設定された場合にエラーが返されることをテスト

